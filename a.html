<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ウェブアプリ</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/utils.js"></script>
</head>

<button id="parmButton">パラメーター取得</button>
<br></br>
room = <label id="label1"></label>
<br></br>
<button id="Call">通話</button>
<button id="HangUp" disabled>終話</button>
<br></br>
<button id="HttpReq">HTTPリクエスト送信</button>
<br></br>
<label id="HttpReqLab"></label>

<script>
    // URLを取得
    let url = new URL(window.location.href);
    // URLSearchParamsオブジェクトを取得
    let params = url.searchParams;

    const label1 = document.getElementById('label1');
    const CallButton = document.getElementById('Call');
    const HangUpButton = document.getElementById('HangUp');
    const parmButton = document.getElementById('parmButton');
    const HttpReqButton = document.getElementById('HttpReq');
    const HttpReqLabButton = document.getElementById('HttpReqLab');
    
    CallButton.addEventListener('click', () => {
        CallButton.disabled = "disabled";
        HangUpButton.disabled = null;
    });

    HangUpButton.addEventListener('click', () => {
        HangUpButton.disabled = "disabled";
        CallButton.disabled = null;
    });

    parmButton.addEventListener('click', () => {
        label1.textContent = params.get('room');
    });

    HttpReqButton.addEventListener('click', () => {
        HttpReqLabButton.textContent = "リクエスト中";
        const xhr = new XMLHttpRequest();
    const url = 'http://192.168.82.110:8080/hochan/api/CallOperator';
    const body = '{"device_name": "#007"}';
    xhr.open('POST', url, true);
    xhr.setRequestHeader('x-api-key','Bearer abcde12345');
    xhr.onreadystatechange = function() 
    {
        if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) 
        {
            HttpReqLabButton.textContent = "送信成功";
        }
    }
    xhr.send(body);
    });
</script>
</html>
